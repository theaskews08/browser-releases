name: Release Browser

on:
  workflow_dispatch:

jobs:
  get_asset:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    env:
      GITHUB_TOKEN: ${{ secrets.PRIVATE_REPO_TOKEN }}   # Use PAT as GITHUB_TOKEN
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: List Releases from voqal/browser-dev
        run: gh release list --repo voqal/browser-dev

      - name: Fetch Latest Release Tag from voqal/browser-dev
        run: |
          LATEST_RELEASE=$(gh release list --repo voqal/browser-dev --limit 1 --json tagName --jq '.[0].tagName')
          echo "LATEST_RELEASE=$LATEST_RELEASE" >> $GITHUB_ENV

      - name: Download Latest Release Assets
        run: |
          gh release download --repo voqal/browser-dev "${{ env.LATEST_RELEASE }}" --dir .
          ls -al

      - name: Create Draft Release in THIS repo
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}   # Built-in token for current repo
        run: |
          TAG="${{ env.LATEST_RELEASE }}"
          gh release create "$TAG" *.dmg *.msi *.deb \
            -t "$TAG" \
            --draft \
            --generate-notes
